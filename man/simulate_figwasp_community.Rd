% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/simulate_figwasp_community.R
\name{simulate_figwasp_community}
\alias{simulate_figwasp_community}
\title{Simulate Fig Wasp Community Assembly (Observed on Ficus racemosa)}
\usage{
simulate_figwasp_community(
  num_figs = 1000,
  fig_diameter_mean = 2.5,
  fig_diameter_sd = 1.2,
  k = 300,
  alpha = 1.3,
  max_entry_table = NULL,
  fecundity_mean,
  fecundity_dispersion,
  entry_mu,
  entry_size,
  entry_priority,
  species_roles,
  entry_distribution = "lognormal",
  interaction_matrix = NULL,
  interaction_weight = 0,
  seed = NULL,
  egg_success_prob = NULL,
  egg_success_prob_by_phase = NULL,
  parasitism_prob = NULL,
  layer_preference = NULL,
  p_pollination_per_ovule = 0.98,
  p_no_entry = 0.002,
  host_sanction = 0.8,
  fig_diameter_min = 1.3,
  fig_diameter_max = 4,
  record_individual = FALSE,
  use_layering = TRUE,
  use_layer_preference = TRUE,
  enable_drop = TRUE,
  drop_cancels_emergence = FALSE,
  use_supplemental_parasitism = FALSE,
  use_flower_limit = TRUE,
  use_egg_success_by_phase = TRUE
)
}
\arguments{
\item{num_figs}{Integer. Number of fig fruits to simulate. Each fig will be treated as a discrete community.}

\item{fig_diameter_mean}{Numeric. Mean fig diameter (in cm). Used to generate per-fig flower number via the formula:
\code{flower_count = k × diameter^\\alpha × Gamma(shape = 20, scale = 0.1)}. Larger diameters yield more ovules.}

\item{fig_diameter_sd}{Numeric. Standard deviation of fig diameter. Each fig's diameter is drawn from a normal distribution with this mean and SD.}

\item{k}{Numeric. Scaling constant for estimating flower number from fig diameter. Represents average number of flowers per cm^\code{alpha}.}

\item{alpha}{Numeric. Exponent in the power-law relationship between fig diameter and flower number. Empirically estimated around 1.2–1.4 for many figs.}

\item{max_entry_table}{Named numeric vector. Maximum number of individuals of each species that can enter a fig, scaled by fig size. Used to truncate simulated entry counts.}

\item{fecundity_mean}{Named numeric vector. Mean number of eggs laid per female individual, per species. Used as \code{mu} in a negative binomial distribution.}

\item{fecundity_dispersion}{Named numeric vector. Dispersion parameter for fecundity (size in NB distribution). Controls variability in egg output across individuals.}

\item{entry_mu}{Named numeric vector. Mean number of individuals of each species attempting to enter each fig. Acts as expected value for entry distribution.}

\item{entry_size}{Named numeric vector. Controls variation in entry distribution:
\itemize{
  \item For \code{entry_distribution = "nb"}: used as NB size parameter.
  \item For \code{"lognormal"}: used to derive \code{sdlog = 1 / sqrt(entry_size)}.
}}

\item{entry_priority}{Named list. Defines the temporal entry order of species. Each element is a phase (e.g., \code{phase1}), with a vector of species names. Earlier phases enter first and may influence resource or host availability for later phases.}

\item{species_roles}{List. Defines the ecological roles and interactions of all species. Contains three components:
\itemize{
  \item \code{guild}: character vector assigning each species to \code{"pollinator"}, \code{"galler"}, or \code{"parasitoid"}.
  \item \code{hosts}: list mapping parasitoids to their hosts.
  \item \code{parasitoid}: list mapping hosts to their attacking parasitoids.
}
This structure defines trophic constraints (e.g., parasitoids cannot oviposit unless their hosts are present).}

\item{entry_distribution}{Character. Either \code{"nb"} (negative binomial) or \code{"lognormal"}.
Defines how per-species entry numbers are simulated:
\itemize{
  \item \code{"nb"}: entries are drawn from NB(\code{mu = entry_mu}, \code{size = entry_size}).
  \item \code{"lognormal"}: \code{log(entry_mu) - 0.5} used as \code{meanlog}; \code{sdlog = 1 / sqrt(entry_size)}; result used as Poisson rate.
}}

\item{interaction_matrix}{Optional numeric matrix. Square matrix defining pairwise interspecific interactions. Each entry affects the entry probability of other species via:
\code{adjusted_mu = entry_mu × exp(interaction_weight × interaction_sum)}.}

\item{interaction_weight}{Numeric. Controls strength of interspecific interactions as defined in \code{interaction_matrix}. 0 means no effect.}

\item{seed}{Integer or NULL. If set, controls random number generation for reproducibility.}

\item{egg_success_prob}{Named numeric vector. Global probability that a single oviposition attempt results in a successful egg. Applies when \code{use_egg_success_by_phase = FALSE}.}

\item{egg_success_prob_by_phase}{Nested list. Overrides global success probabilities by entry phase. Format: \code{species_name = list(phase1 = 0.5, phase2 = 0.7, ...)}.}

\item{parasitism_prob}{Named numeric vector. Probability that supplemental parasitism occurs for each parasitoid species. Used only if \code{use_supplemental_parasitism = TRUE}.}

\item{layer_preference}{Named list. For each species, a named numeric vector giving probabilities of oviposition in \code{core}, \code{mid}, and \code{outer} flower layers. Sum must be 1. Used only if \code{use_layering = TRUE}.}

\item{p_pollination_per_ovule}{Numeric [0–1]. Probability that each unused ovule becomes a viable seed, representing background pollination efficiency.}

\item{p_no_entry}{Numeric [0–1]. Probability that a fig receives no wasp entries. Simulates failed colonization events.}

\item{host_sanction}{Numeric [0–1]. Threshold of flower use (e.g., 0.8). If exceeded, the fig may abort (drop) due to excessive exploitation by wasps.}

\item{fig_diameter_min, }{fig_diameter_max Numeric. Truncate simulated diameters (and thus flower counts) to a biologically reasonable range.}

\item{fig_diameter_max}{Maximum fig diameter used to cap values (optional).}

\item{record_individual}{Logical. If \code{TRUE}, the function returns an additional element \code{individual_eggs}, which records per-individual oviposition events (vector of eggs per female).}

\item{use_layering}{Logical. If \code{TRUE}, fig flowers are divided into spatial layers (core, mid, outer).}

\item{use_layer_preference}{Logical. If \code{TRUE}, species will preferentially oviposit in specific layers as defined in \code{layer_preference}.}

\item{enable_drop}{Logical. Enables fig abortion due to host sanctions. If flower use proportion exceeds \code{host_sanction}, fig may abort.}

\item{drop_cancels_emergence}{Logical. If \code{FALSE}, dropped figs produce zero emergence and seeds. If \code{TRUE}, their output remains.}

\item{use_supplemental_parasitism}{Logical. Enables additional parasitoid attack if hosts exist but parasitoid did not enter during regular phases.}

\item{use_flower_limit}{Logical. If \code{TRUE}, clamps fig diameter between \code{fig_diameter_min} and \code{fig_diameter_max} before calculating flower number.}

\item{use_egg_success_by_phase}{Logical. If \code{TRUE}, uses phase-specific success probabilities (if defined).}
}
\value{
A list containing:
\itemize{
  \item \code{summary}: A data.frame with per-fig simulation outputs, including:
    \code{fig_diameter}, \code{flower_count}, \code{resource_use},
    \code{entry_<species>}, \code{eggs_<species>}, \code{emergence_<species>},
    \code{seeds}, \code{failed_ovules}, \code{drop_prob}, \code{is_dropped}.
  \item \code{individual_eggs} (optional): List of individual-level egg counts.
}
}
\description{
This function simulates fig wasp community structure within a set of fig fruits,
incorporating priority effects, host–parasitoid interactions, resource constraints,
pollination, oviposition success, and fig abortion mechanisms.
}
\details{
Each simulation models community assembly in a number of fig fruits, where:
\itemize{
  \item Flower number is determined by fig diameter and stochastic heterogeneity.
  \item Wasp species arrive in \code{entry_priority} phases (priority effects).
  \item Pollinators and gallers lay eggs into limited ovules.
  \item Parasitoids require host presence and attack host eggs.
  \item Layer preference can restrict oviposition to \code{core}, \code{mid}, or \code{outer} layers.
  \item Figs may abort (drop) if flower usage exceeds \code{host_sanction}.
}

Species roles, hosts, and parasitoid links must be defined in \code{species_roles}.
Default species and parameter values are provided in \code{\link{species_list}} and \code{\link{parameter_list_default}}.
}
\examples{
data(species_list)
data(parameter_list_default)
sim_result <- simulate_figwasp_community(
  num_figs = 10,
  fecundity_mean = parameter_list_default$fecundity_mean,
  fecundity_dispersion = parameter_list_default$fecundity_dispersion,
  entry_mu = parameter_list_default$entry_mu,
  entry_size = parameter_list_default$entry_size,
  entry_priority = parameter_list_default$entry_priority,
  species_roles = parameter_list_default$species_roles,
  max_entry_table = parameter_list_default$max_entry_table,
  interaction_matrix = parameter_list_default$interaction_matrix,
  interaction_weight = parameter_list_default$interaction_weight,
  egg_success_prob = parameter_list_default$egg_success_prob,
  egg_success_prob_by_phase = parameter_list_default$egg_success_prob_by_phase,
  parasitism_prob = parameter_list_default$parasitism_prob,
  layer_preference = parameter_list_default$layer_preference,
  record_individual = FALSE
)
head(sim_result$summary)

}
