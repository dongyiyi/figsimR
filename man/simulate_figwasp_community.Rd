% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/simulate_figwasp_community.R
\name{simulate_figwasp_community}
\alias{simulate_figwasp_community}
\title{Simulate Fig Wasp Community Assembly (Observed on Ficus racemosa)}
\usage{
simulate_figwasp_community(
  num_figs = 1000,
  fig_diameter_mean = 2.5,
  fig_diameter_sd = 1.2,
  k = 300,
  alpha = 1.3,
  max_entry_table = NULL,
  fecundity_mean,
  fecundity_dispersion,
  entry_mu,
  entry_size,
  entry_priority,
  species_roles,
  entry_distribution = "lognormal",
  interaction_matrix = NULL,
  interaction_weight = 0,
  seed = NULL,
  egg_success_prob = NULL,
  egg_success_prob_by_phase = NULL,
  parasitism_prob = NULL,
  layer_preference = NULL,
  p_pollination_per_ovule = 0.98,
  p_no_entry = 0.002,
  host_sanction = 0.8,
  fig_diameter_min = 1.3,
  fig_diameter_max = 4,
  record_individual = FALSE,
  use_layering = TRUE,
  use_layer_preference = TRUE,
  enable_drop = TRUE,
  drop_cancels_emergence = FALSE,
  use_supplemental_parasitism = FALSE,
  use_flower_limit = TRUE,
  use_egg_success_by_phase = TRUE,
  use_sink_strength = FALSE,
  sink_w_gall = 1,
  sink_w_seed = 1.5,
  sink_linear_coef = 1,
  sink_min_prop = 0.2,
  sink_max_prop = 0.95
)
}
\arguments{
\item{num_figs}{Integer. Number of fig fruits to simulate. Each fig will be treated as a discrete community.}

\item{fig_diameter_mean}{Numeric. Mean fig diameter (in cm).}

\item{fig_diameter_sd}{Numeric. SD of fig diameter.}

\item{k}{Numeric. Scaling constant for estimating flower number from fig diameter.}

\item{alpha}{Numeric. Exponent in the diameter–flower power-law.}

\item{max_entry_table}{Named numeric vector. Per-species entry caps (scaled by fig size).}

\item{fecundity_mean, }{fecundity_dispersion Named numeric vectors for NB fecundity.}

\item{entry_mu, }{entry_size Named numeric vectors controlling entry distribution.}

\item{entry_priority}{Named list of phases and species.}

\item{species_roles}{List with $guild, $hosts, $parasitoid.}

\item{entry_distribution}{"nb" or "lognormal".}

\item{interaction_matrix}{Optional numeric matrix (pairwise interactions).}

\item{interaction_weight}{Numeric. Strength of interaction effects.}

\item{seed}{RNG seed (optional).}

\item{egg_success_prob}{Global oviposition success (if not using phase-specific).}

\item{egg_success_prob_by_phase}{List of per-phase success probs by species.}

\item{parasitism_prob}{Named numeric vector for supplemental parasitism.}

\item{layer_preference}{Named list of layer probabilities per species.}

\item{p_pollination_per_ovule}{Numeric [0–1]. Background pollination to seeds.}

\item{p_no_entry}{Numeric [0–1]. Probability a fig receives no entries.}

\item{host_sanction}{Numeric [0–1]. Legacy overuse threshold for drop logic.}

\item{fig_diameter_min, }{fig_diameter_max Numeric. Truncation bounds (if used).}

\item{record_individual}{Logical. If TRUE, per-individual oviposition recorded.}

\item{use_layering, use_layer_preference}{Logical switches for layering.}

\item{enable_drop}{Logical. Enable legacy drop (host_sanction) mechanism.}

\item{drop_cancels_emergence}{Logical. If FALSE, dropped figs yield zero output.}

\item{use_supplemental_parasitism}{Logical.}

\item{use_flower_limit}{Logical.}

\item{use_egg_success_by_phase}{Logical.}

\item{use_sink_strength}{Logical. If TRUE, compute sink-strength metrics but
do NOT alter legacy drop decision. Adds columns: sink_strength, sink_prop,
sink_below_min, sink_above_max.}

\item{sink_w_gall}{Numeric in [0, +). Per-ovule sink weight for galled ovules (default 1.0).}

\item{sink_w_seed}{Numeric in [0, +). Per-ovule sink weight for seeds (default 1.5).}

\item{sink_linear_coef}{Numeric. Global multiplier on sink strength (default 1.0).}

\item{sink_min_prop}{Numeric in [0,1]. Reference lower bound of sink proportion (default 0.20).}

\item{sink_max_prop}{Numeric in [0,1]. Reference upper bound of sink proportion (default 0.95).}
}
\value{
list(summary = data.frame(...), individual_eggs = list() if requested)
}
\description{
This function simulates fig wasp community structure within a set of fig fruits,
incorporating priority effects, host–parasitoid interactions, resource constraints,
pollination, oviposition success, and fig abortion mechanisms.
}
\details{
Each simulation models community assembly in a number of fig fruits, where:
\itemize{
  \item Flower number is determined by fig diameter and stochastic heterogeneity.
  \item Wasp species arrive in \code{entry_priority} phases (priority effects).
  \item Pollinators and gallers lay eggs into limited ovules.
  \item Parasitoids require host presence and attack host eggs.
  \item Layer preference can restrict oviposition to \code{core}, \code{mid}, or \code{outer} layers.
  \item Figs may abort (drop) if flower usage exceeds \code{host_sanction}.
}

Species roles, hosts, and parasitoid links must be defined in \code{species_roles}.
Default species and parameter values are provided in \code{\link{species_list}} and \code{\link{parameter_list_default}}.
}
\examples{
data(species_list)
data(parameter_list_default)
set.seed(123)
sim_result <- simulate_figwasp_community(
  num_figs = 10,
  fecundity_mean = parameter_list_default$fecundity_mean,
  fecundity_dispersion = parameter_list_default$fecundity_dispersion,
  entry_mu = parameter_list_default$entry_mu,
  entry_size = parameter_list_default$entry_size,
  entry_priority = parameter_list_default$entry_priority,
  species_roles = parameter_list_default$species_roles,
  max_entry_table = parameter_list_default$max_entry_table,
  interaction_matrix = parameter_list_default$interaction_matrix,
  interaction_weight = parameter_list_default$interaction_weight,
  egg_success_prob = parameter_list_default$egg_success_prob,
  egg_success_prob_by_phase = parameter_list_default$egg_success_prob_by_phase,
  parasitism_prob = parameter_list_default$parasitism_prob,
  layer_preference = parameter_list_default$layer_preference,
  record_individual = TRUE,
  use_sink_strength = TRUE,
  sink_w_gall = 1.0,
  sink_w_seed = 1.5,
  sink_linear_coef = 1.0,
  sink_min_prop = 0.20,
  sink_max_prop = 0.95
)
head(sim_result$summary)
}
